<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment Logic Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-scenario { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .test-result { margin: 10px 0; padding: 10px; }
        .success { background-color: #d4edda; }
        .warning { background-color: #fff3cd; }
        .error { background-color: #f8d7da; }
        table { border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        .unassigned { background-color: #ffeaa7; }
    </style>
</head>
<body>
    <h1>Assignment Logic Test</h1>
    
    <div class="test-scenario">
        <h2>Test Scenario 1: Basic Assignment (Adequate Staff)</h2>
        <p><strong>Staff:</strong> 4 healthcare workers</p>
        <p><strong>Patients:</strong> 2 patients requiring 1 staff each</p>
        <p><strong>Expected:</strong> No UNASSIGNED cells</p>
        <div id="test1-result"></div>
    </div>

    <div class="test-scenario">
        <h2>Test Scenario 2: Insufficient Staff</h2>
        <p><strong>Staff:</strong> 2 healthcare workers</p>
        <p><strong>Patients:</strong> 3 patients requiring 1 staff each</p>
        <p><strong>Expected:</strong> Some patients may share staff, but no UNASSIGNED cells</p>
        <div id="test2-result"></div>
    </div>

    <div class="test-scenario">
        <h2>Test Scenario 3: High Care Requirements</h2>
        <p><strong>Staff:</strong> 3 healthcare workers</p>
        <p><strong>Patients:</strong> 1 patient requiring 3 staff</p>
        <p><strong>Expected:</strong> All staff assigned to the single patient</p>
        <div id="test3-result"></div>
    </div>

    <script>
        // Simplified simulation of the assignment logic
        function simulateAssignment(staffCount, patients) {
            const timeSlots = ['08:00', '09:00', '10:00', '11:00', '12:00'];
            const staff = [];
            for (let i = 1; i <= staffCount; i++) {
                staff.push(`Staff${i}`);
            }

            const schedule = {};
            timeSlots.forEach(time => {
                schedule[time] = { patientAssignments: {} };
                patients.forEach(patient => {
                    schedule[time].patientAssignments[patient.name] = [];
                });
            });

            // Simple assignment algorithm (similar to our improved version)
            timeSlots.forEach(time => {
                let availableStaff = [...staff];
                
                // Sort patients by staffCount (highest first)
                const sortedPatients = [...patients].sort((a, b) => b.staffCount - a.staffCount);

                // Multiple passes to ensure everyone gets assigned
                let passCount = 0;
                const maxPasses = 3;

                while (passCount < maxPasses) {
                    let allPatientsAssigned = true;

                    for (const patient of sortedPatients) {
                        const currentAssigned = schedule[time].patientAssignments[patient.name].length;
                        const staffNeeded = patient.staffCount - currentAssigned;

                        if (staffNeeded > 0) {
                            allPatientsAssigned = false;
                            const staffToAssign = Math.min(staffNeeded, availableStaff.length);

                            for (let i = 0; i < staffToAssign; i++) {
                                const staffMember = availableStaff.shift();
                                if (staffMember) {
                                    schedule[time].patientAssignments[patient.name].push(staffMember);
                                }
                            }
                        }
                    }

                    if (allPatientsAssigned) break;
                    passCount++;
                }

                // Final emergency assignment if still unassigned
                for (const patient of patients) {
                    const currentAssigned = schedule[time].patientAssignments[patient.name].length;
                    const staffNeeded = patient.staffCount - currentAssigned;

                    if (staffNeeded > 0 && availableStaff.length > 0) {
                        const staffToAssign = Math.min(staffNeeded, availableStaff.length);
                        for (let i = 0; i < staffToAssign; i++) {
                            const staffMember = availableStaff.shift();
                            if (staffMember) {
                                schedule[time].patientAssignments[patient.name].push(staffMember);
                            }
                        }
                    }
                }
            });

            return schedule;
        }

        function renderTestResult(schedule, patients, timeSlots, containerId) {
            const container = document.getElementById(containerId);
            let hasUnassigned = false;
            let html = '<table>';
            
            // Header
            html += '<tr><th>Patient</th>';
            timeSlots.forEach(time => {
                html += `<th>${time}</th>`;
            });
            html += '</tr>';

            // Patient rows
            patients.forEach(patient => {
                html += `<tr><td>${patient.name} (needs ${patient.staffCount})</td>`;
                timeSlots.forEach(time => {
                    const assigned = schedule[time].patientAssignments[patient.name];
                    if (assigned.length === 0) {
                        html += '<td class="unassigned">UNASSIGNED</td>';
                        hasUnassigned = true;
                    } else if (assigned.length < patient.staffCount) {
                        html += `<td class="warning">${assigned.join(', ')} (${assigned.length}/${patient.staffCount})</td>`;
                    } else {
                        html += `<td class="success">${assigned.join(', ')}</td>`;
                    }
                });
                html += '</tr>';
            });
            
            html += '</table>';

            const resultClass = hasUnassigned ? 'error' : 'success';
            const resultText = hasUnassigned ? 'FAILED: Has UNASSIGNED cells' : 'PASSED: No UNASSIGNED cells';
            
            container.innerHTML = `
                <div class="test-result ${resultClass}">${resultText}</div>
                ${html}
            `;
        }

        // Run tests
        function runTests() {
            const timeSlots = ['08:00', '09:00', '10:00', '11:00', '12:00'];

            // Test 1: Adequate staff
            const test1Schedule = simulateAssignment(4, [
                { name: 'Patient A', staffCount: 1 },
                { name: 'Patient B', staffCount: 1 }
            ]);
            renderTestResult(test1Schedule, [
                { name: 'Patient A', staffCount: 1 },
                { name: 'Patient B', staffCount: 1 }
            ], timeSlots, 'test1-result');

            // Test 2: Insufficient staff
            const test2Schedule = simulateAssignment(2, [
                { name: 'Patient A', staffCount: 1 },
                { name: 'Patient B', staffCount: 1 },
                { name: 'Patient C', staffCount: 1 }
            ]);
            renderTestResult(test2Schedule, [
                { name: 'Patient A', staffCount: 1 },
                { name: 'Patient B', staffCount: 1 },
                { name: 'Patient C', staffCount: 1 }
            ], timeSlots, 'test2-result');

            // Test 3: High care requirements
            const test3Schedule = simulateAssignment(3, [
                { name: 'Patient ICU', staffCount: 3 }
            ]);
            renderTestResult(test3Schedule, [
                { name: 'Patient ICU', staffCount: 3 }
            ], timeSlots, 'test3-result');
        }

        // Run tests when page loads
        runTests();
    </script>
</body>
</html>
