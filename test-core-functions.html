<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Functions Test</title>
</head>
<body>
    <h1>Core Functions Test</h1>
    <div id="results"></div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Test basic schedule generation logic
        console.log("Starting core function tests...");
        
        // Mock data
        const testStaff = ["Alice", "Bob", "Charlie", "Diana"];
        const testPatients = ["Patient A", "Patient B"];
        const testTimeSlots = ["08:00", "09:00", "10:00", "11:00"];
        let testSchedule = {};
        
        // Initialize test schedule
        testTimeSlots.forEach(time => {
            testSchedule[time] = {
                patientAssignments: {},
                staffBreaks: {}
            };
            testPatients.forEach(patient => {
                testSchedule[time].patientAssignments[patient] = [];
            });
        });
        
        // Test round-robin assignment
        function testRoundRobinAssignment() {
            let staffIndex = 0;
            
            testPatients.forEach((patient, patientIndex) => {
                testTimeSlots.forEach((time, timeIndex) => {
                    const assignedStaff = testStaff[staffIndex % testStaff.length];
                    testSchedule[time].patientAssignments[patient] = [assignedStaff];
                    staffIndex++;
                });
            });
            
            return testSchedule;
        }
        
        // Run test
        const result = testRoundRobinAssignment();
        
        // Display results
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = `
            <h2>Test Results</h2>
            <pre>${JSON.stringify(result, null, 2)}</pre>
        `;
        
        // Validate results
        let isValid = true;
        let validationMessages = [];
        
        // Check that all patients have assignments
        testTimeSlots.forEach(time => {
            testPatients.forEach(patient => {
                if (!result[time].patientAssignments[patient] || result[time].patientAssignments[patient].length === 0) {
                    isValid = false;
                    validationMessages.push(`Missing assignment for ${patient} at ${time}`);
                }
            });
        });
        
        // Check staff distribution
        const staffAssignmentCounts = {};
        testStaff.forEach(staff => staffAssignmentCounts[staff] = 0);
        
        testTimeSlots.forEach(time => {
            testPatients.forEach(patient => {
                const assigned = result[time].patientAssignments[patient];
                if (assigned && assigned.length > 0) {
                    staffAssignmentCounts[assigned[0]]++;
                }
            });
        });
        
        console.log("Staff assignment counts:", staffAssignmentCounts);
        
        // Check if distribution is reasonably fair (within 1 assignment difference)
        const counts = Object.values(staffAssignmentCounts);
        const minCount = Math.min(...counts);
        const maxCount = Math.max(...counts);
        
        if (maxCount - minCount > 1) {
            validationMessages.push(`Unfair staff distribution: min=${minCount}, max=${maxCount}`);
        }
        
        // Display validation results
        resultsDiv.innerHTML += `
            <h2>Validation</h2>
            <p><strong>Valid:</strong> ${isValid && validationMessages.length === 0 ? 'YES' : 'NO'}</p>
            <p><strong>Staff Assignments:</strong> ${JSON.stringify(staffAssignmentCounts)}</p>
            ${validationMessages.length > 0 ? '<p><strong>Issues:</strong><br>' + validationMessages.join('<br>') + '</p>' : ''}
        `;
        
        console.log("Test complete. Valid:", isValid && validationMessages.length === 0);
    </script>
</body>
</html>
